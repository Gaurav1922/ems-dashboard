{% extends 'employees/base.html' %}

{% block title %}Message History - EMS{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h2><i class="fas fa-history me-2"></i>Message History - {{ employee.full_name }}</h2>
      <a href="{% url 'messaging_dashboard' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to Messaging
      </a>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      {% if message_list %}
        <table class="table table-striped table-hover">
          <thead class="table-light">
            <tr>
              <th>Type</th>
              <th>Subject / Content</th>
              <th>Status</th>
              <th>Sent At</th>
            </tr>
          </thead>
          <tbody>
            {% for msg in message_list %}
              <tr>
                <td>
                  {% if msg.message_type == "email" %}
                    <i class="fas fa-envelope text-primary"></i> Email
                  {% else %}
                    <i class="fab fa-whatsapp text-success"></i> WhatsApp
                  {% endif %}
                </td>
                <td>
                  {% if msg.message_type == "email" %}
                    <strong>{{ msg.subject }}</strong><br>
                  {% endif %}
                  {{ msg.content|truncatewords:20 }}
                </td>
                <td>
                  {% if msg.is_sent %}
                    <span class="badge bg-success">Sent</span>
                  {% else %}
                    <span class="badge bg-danger">Failed</span>
                    {% if msg.error_message %}
                      <br><small class="text-muted">{{ msg.error_message }}</small>
                    {% endif %}
                  {% endif %}
                </td>
                <td>
                  {% if msg.sent_at %}
                    {{ msg.sent_at|date:"M d, Y H:i" }}
                  {% else %}
                    <em>Not Available</em>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-muted">No messages sent to this employee yet.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
